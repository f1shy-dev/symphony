<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Symphony Debugger</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=DM+Sans&display=swap"
      rel="stylesheet"
    />
  </head>
  <style>
    * {
      font-family: "DM Sans", sans-serif !important;
      font-size: 16px;
    }

    body {
      margin: 0;
    }

    .conversation {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .messages {
      flex-grow: 1;
      padding: 8px;
    }

    .controls {
      display: flex;
      flex-direction: row;
      gap: 8px;
      padding: 8px;
    }

    .input {
      flex-grow: 1;
      padding: 8px;
      border: 1px solid #ccc;
    }
  </style>
  <body>
    <div class="conversation">
      <div class="messages"></div>

      <div class="controls">
        <input class="input" type="text" id="input" />
        <button class="button" onclick="sendMsg()">Send</button>
      </div>
    </div>

    <script>
      const socket = new WebSocket("ws://localhost:3000");

      const messages = [];
      const messagesElement = document.querySelector(".messages");

      function updateMessages() {
        messagesElement.innerHTML = messages
          .map((message) => `<div class="message">${message}</div>`)
          .join("");
      }

      socket.onopen = function (event) {
        console.log("Connected to Symphony");
      };

      socket.onmessage = function (event) {
        console.log("Received:", event.data);

        const message = JSON.parse(event.data);
        messages.push(message.content);
        updateMessages();
      };

      socket.onerror = function (error) {
        console.error("WebSocket Error:", error);
      };

      socket.onclose = function (event) {
        if (event.wasClean) {
          console.log("Closed cleanly", event.code, event.reason);
        } else {
          console.error("Connection died");
        }
      };

      function sendMsg() {
        const inputElement = document.getElementById("input");

        const message = {
          role: "user",
          content: inputElement.value,
        };

        socket.send(JSON.stringify(message));
        messages.push(message.content);
        updateMessages();

        inputElement.value = "";
      }
    </script>
  </body>
</html>
